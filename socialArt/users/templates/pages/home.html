{% extends "base.html" %}

{% block title %} SocialArt {% endblock %}

{% block header %}
<header class="border-b-8 border-indigo-700 bg-white w-full h-14 fixed top-0 z-50">
    <nav class="flex items-center justify-between h-full relative">
        <h2 class="ml-5 uppercase text-2xl font-black">{{ user.username }}</h2>
        <div class="relative">
            <button data-modal-target="defaultModal" data-modal-toggle="defaultModal"
                class="mr-5 bg-indigo-600 text-slate-200 px-3 py-2 font-bold transition-all ease-in delay-[10ms] hover:bg-indigo-700 capitalize">Notification</button>
            <a href="{% url 'search' %}"
                class="mr-5 border-b-2 border-black transition-all ease-in delay-[10ms] hover:border-amber-600 hover:text-amber-600">Search
                Friends</a>
            <a class="mr-5 border-b-2 border-black transition-all ease-in delay-[10ms] hover:border-amber-600 hover:text-amber-600"
                href="{% url 'logout' %}">Logout</a>
        </div>
    </nav>
</header>
{% endblock %}

{% block content %}
<main class="w-full flex bg-neutral-200 mt-14 ">

    <section class="w-3/4 mt-3">

        <header class="flex flex-col items-center relative mb-4 z-0">

            <button class="bg-white text-xl absolute pb-1 w-8 left-[6%] top-[17%] z-10 box-content"
                id="leftHistory">&lt</button>

            <section class="overflow-x-hidden flex items-center w-10/12 mx-5 gap-2 absolute z-0" id="historySlider">
                <div class="w-36 shrink-0 h-48 flex">
                    <img src="https://www.swissinfo.ch/resource/image/44723544/landscape_ratio3x2/640/426/a86b5f369a9802206f77923ca5c19c94/F6CF3F86D3DAE45ECE23F135347ED9FF/teaser_angleterre_joy_the-bayswater-omnibus_hd-web.jpg"
                        loading="lazy" alt="" class="object-cover object-center">
                </div>
                <div class="w-36 shrink-0 h-48 flex">
                    <img src="https://www.swissinfo.ch/resource/image/44723544/landscape_ratio3x2/640/426/a86b5f369a9802206f77923ca5c19c94/F6CF3F86D3DAE45ECE23F135347ED9FF/teaser_angleterre_joy_the-bayswater-omnibus_hd-web.jpg"
                        loading="lazy" alt="" class="object-cover object-center">
                </div>
                <div class="w-36 shrink-0 h-48 flex">
                    <img src="https://www.swissinfo.ch/resource/image/44723544/landscape_ratio3x2/640/426/a86b5f369a9802206f77923ca5c19c94/F6CF3F86D3DAE45ECE23F135347ED9FF/teaser_angleterre_joy_the-bayswater-omnibus_hd-web.jpg"
                        loading="lazy" alt="" class="object-cover object-center">
                </div>
                <div class="w-36 shrink-0 h-48 flex">
                    <img src="https://www.swissinfo.ch/resource/image/44723544/landscape_ratio3x2/640/426/a86b5f369a9802206f77923ca5c19c94/F6CF3F86D3DAE45ECE23F135347ED9FF/teaser_angleterre_joy_the-bayswater-omnibus_hd-web.jpg"
                        loading="lazy" alt="" class="object-cover object-center">
                </div>
                <div class="w-36 shrink-0 h-48 flex">
                    <img src="https://www.swissinfo.ch/resource/image/44723544/landscape_ratio3x2/640/426/a86b5f369a9802206f77923ca5c19c94/F6CF3F86D3DAE45ECE23F135347ED9FF/teaser_angleterre_joy_the-bayswater-omnibus_hd-web.jpg"
                        loading="lazy" alt="" class="object-cover object-center">
                </div>
                <div class="w-36 shrink-0 h-48 flex">
                    <img src="https://www.swissinfo.ch/resource/image/44723544/landscape_ratio3x2/640/426/a86b5f369a9802206f77923ca5c19c94/F6CF3F86D3DAE45ECE23F135347ED9FF/teaser_angleterre_joy_the-bayswater-omnibus_hd-web.jpg"
                        loading="lazy" alt="" class="object-cover object-center">
                </div>
            </section>

            <button class="bg-white text-xl absolute pb-1 w-8 text-center right-[6%] top-[17%] z-10"
                id="rightHistory">&gt</button>

            <section class="mt-52 flex flex-col items-center justify-center w-2/3 bg-white text-black font-medium p-4">
                <form class="flex flex-col w-9/12" method="post">
                    {{ context.form.as_p }}
                    {% csrf_token %}
                    <button type="submit"
                        class="w-1/2 mt-3 self-center bg-indigo-600 text-slate-200 px-3 py-2 font-bold transition-all ease-in delay-[10ms] hover:bg-indigo-700 capitalize">
                        postear
                    </button>
                </form>
            </section>

        </header>

        <main class="flex flex-col items-center">
            {% for post in context.posts %}
            <section class="w-2/3 flex bg-white flex-col items-center">
                <header class="flex flex-col px-3 pb-2 p-1 w-full">
                    <div class="flex items-center justify-between px-2">
                        <h3 class="text-xl font-medium capitalize">{{ post.user }}</h3>
                        <span class="text-xs">{{ post.created_at }}</span>
                    </div>
                    <p class="break-words text-sm px-2 pt-2">{{ post.content }}</p>
                </header>
                <main>
                    {% if post.url_image %}
                    <div class="flex max-w-[640px]">
                        <img src="{{ post.url_image }}" loading="lazy" alt="ima" class="object-cover object-center">
                    </div>
                    {% endif %}
                </main>
                <footer class="w-full px-5 py-2 flex flex-col">
                    <div class="border-b-2 border-amber-600 pb-2">
                        <span>❤ {{ post.num_likes }}</span>
                    </div>
                    <div class="flex gap-2 mt-1">
                        <form action="{% url 'like_post' post.id %}" class="w-1/2" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="post_id" value="{{ post.id }}">
                            <button type="submit"
                                class="w-full py-1 transition-all ease-in delay-[10ms] hover:bg-zinc-200">Like</button>
                        </form>
                        <button
                            class="w-1/2 py-1 transition-all ease-in delay-[10ms] hover:bg-zinc-200">Comment</button>
                    </div>
                </footer>
            </section>
            <br>
            {% empty %}
            <h3>Sigue a más gente para más publicaciones en tu feed</h3>
            {% endfor %}

        </main>

        <br>
    </section>

    <section class="w-1/4 fixed boder-2 border-amber-600 overflow-y-auto right-0 top-12 bottom-0">
        <h5 class="capitalize text-xl font-black mt-3">Contactos</h5>
        <main class="flex flex-col overflow-y-auto">
            {% for friend in context.friends %}
            <div class="h-10 flex items-center">
                <span class="capitalize font-medium text-lg">
                    {{ friend.from_user }}
                </span>
            </div>
            {% endfor %}
        </main>
    </section>
</main>

<section id="defaultModal" tabindex="-1" aria-hidden="true"
    class="fixed hidden top-0 left-0 right-0 z-50 w-full p-4 overflow-x-hidden h-screen flex items-center justify-center bg-slate-900 bg-opacity-75">
    <div class="relative w-full max-w-2xl max-h-full overflow-y-auto">
        <!-- Modal Content -->
        <section id="contentModal" class="relative bg-white rounded">
            <!-- Modal header -->
            <header class="flex items-start justify-between py-2 px-4">
                <h3 class="text-2xl font-semibold uppercase text-center">
                    Notifications
                </h3>
                <button type="button"
                    class="text-black bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded text-sm w-8 h-8 ml-auto inline-flex justify-center items-center"
                    data-modal-hidden="defaultModal">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </header>
            <main>
                {% for request in context.friend_request_received %}
                <div class="flex px-5 py-3 justify-evenly items-center">
                    <span class="w-full py-3">
                        {{ request.from_user }}
                    </span>
                    <form action="{% url 'accept_friend' request.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit"
                            class="bg-indigo-600 text-slate-200 px-3 py-2 font-bold transition-all ease-in delay-[10ms] hover:bg-indigo-700 capitalize">Aceptar</button>
                    </form>
                </div>
                {% empty %}
                <div class="flex px-5 py-3 justify-evenly items-center font-semibold    ">
                    <span>You don't have Notifications</span>
                </div>
                {% endfor %}
            </main>
        </section>
    </div>
</section>
{% endblock %}



{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        function autoResize() {
            this.style.height = "0px";
            this.style.height = this.scrollHeight + 'px';
        }

        const textarea = document.querySelector("#id_content");
        textarea.addEventListener('input', autoResize, false);

        const leftHistory = document.querySelector('#leftHistory')
        const rightHistory = document.querySelector('#rightHistory')
        const historySlider = document.querySelector('#historySlider')

        const modal = document.querySelector('#defaultModal');
        const contentModal = document.querySelector('#contentModal');

        const notificationButton = document.querySelector('[data-modal-toggle="defaultModal"]');
        const closeButton = document.querySelector('[data-modal-hidden="defaultModal"]');


        const showModal = () => {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        };

        const hiddenModal = () => {
            modal.classList.remove('flex');
            modal.classList.add('hidden');
        };

        const handleMoveLeft = (e) => {
            historySlider.scrollLeft -= 150;
        }

        const handleMoveRight = (e) => {
            historySlider.scrollLeft += 150;
        }

        leftHistory.addEventListener('click', e => handleMoveLeft(e))
        rightHistory.addEventListener('click', () => handleMoveRight());
        closeButton.addEventListener('click', hiddenModal);
        notificationButton.addEventListener('click', showModal)
        window.addEventListener('click', function (e) {
            if (e.target == modal) {
                modal.classList.remove('flex')
                modal.classList.add('hidden')
            }
        })
    })
</script>
{% endblock %}